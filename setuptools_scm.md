# python package versioning with setuptools_scm

`setuptools_scm` generate a version number for PKG-INFO from the status of a git repository. The version number records the distance to the latest tag, including whether the repo is in an uncommitted (dirty) state. The version number is not committed to a file in the repo.

To use `setuptools_scm` add this to _pyproject.toml_:

```toml
[project]
# version = "0.0.1"  # Remove any existing version parameter.
dynamic = ["version"]

[build-system]
requires = ["setuptools>=45", "setuptools_scm[toml]>=6.2"]

# enable setuptools_scm to set the version based on git tags
[tool.setuptools_scm]
```

Or if using _setup.py_:

```python
    use_scm_version=True,
    setup_requires=['setuptools_scm'],
```

Versions are calculated from the git repo state as per [Default versioning scheme](https://github.com/pypa/setuptools_scm/blob/main/docs/usage.md#default-versioning-scheme).

To see the current version install setuptools_scm and run:

```shell
python -m setuptools_scm

0.1.dev13+g614e501.d20210327
```

## Reading version at runtime

When building an sdist the version will be written to _PKG-INFO_. It can be retrieved at runtime using `importlib.metadata` see [Retrieving package version at runtime](https://github.com/pypa/setuptools_scm#retrieving-package-version-at-runtime)

### Writing a version file

Alternatively, a version file can also be written using `write_to`:

```
# optional
[tool.setuptools_scm]
write_to = "yourpkg/_version.py"
```

The version should be added to _.gitignore_ to avoid being committed.

Example of what's written:

```python
# file generated by setuptools_scm
# don't change, don't track in version control
__version__ = version = '2.7.4.dev1+g29670f5.d20230314'
__version_tuple__ = version_tuple = (2, 7, 4, 'dev1', 'g29670f5.d20230314')
```

## Docker

The .git directory is needed when running your python build inside a Docker container. See [Usage from Docker](https://github.com/pypa/setuptools_scm/#usage-from-docker)

## vs versioneer

versioneer works in a similar way to setuptools_scm but does not appear to be maintained.
